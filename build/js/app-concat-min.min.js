!function(o){o.module("portfolio",["angular-flexslider"]).controller("PortfolioController",["$scope","$timeout","$window","rowsFactory","appConfig",function(o,t,r,e,i){o.overflow_hidden=!1;var n=i.getConfig();o.theme=n.theme,o.image_ratio=n.image_ratio,o.pieces_per_row=n.pieces_per_row,o.app_path=n.app_path,o.rows||e.getRows().then(function(t){o.rows=t}),o.$watch(function(){return r.innerWidth},function(t){o.window_width=t})}]).controller("desktopController",["$scope","$q","$timeout","$interval","$window","appConfig",function(o,t,r,e,i,n){var s=n.getConfig(),p=!1,a=!1,_=!1,c=0,f=!1,u=0,l=0;function h(){0===u&&(o.$parent.overflow_hidden=!0,o.curr_transforming=!0),u<s.pieces_per_row&&u++}function g(){++l==s.pieces_per_row&&r(function(){l=u=0,o.curr_transforming=!1,o.$parent.overflow_hidden=!1},50)}function d(e,i,n){h();var p=t.defer(),a=o.rows[s.ppr_key][e].toggles;return r(function(){a[n]["hideBackNbrImg_"+i.toString()]=!1,a[n].descriptionActive=!1,a[n].notFlippable=!0,w(e,n),r(function(){},s.transition_time).then(function(){p.resolve()})},s.transition_time_padding),p.promise}function m(e,i,n){h();var p=t.defer(),a=o.rows[s.ppr_key][e].toggles;return a[n].descriptionActive=!1,a[n].notFlippable=!1,w(e,n),r(function(){a[n]["hideBackNbrImg_"+i.toString()]=!0,p.resolve()},s.transition_time),p.promise}function w(t,e){var i=o.rows[s.ppr_key][t].toggles;i[e].transforming=!0,i[e].transform=!i[e].transform,i[e].frontHover=!1,r(function(){i[e].transforming=!1},s.transition_time)}o.curr_transforming=!1,o.showMoreToggle=function(e,n,f,u){if(e&&e.stopPropagation(),!o.curr_transforming)if(p){if(u||n!=a||n==a&&f!=_){for(l=0;l<=s.pieces_per_row_zero;l++)l!=_&&m(a,_,l).then(g);for(function(e,i){h();var n=t.defer(),p=o.rows[s.ppr_key][e].toggles;return r(function(){w(e,i),r(function(){p[i].showMoreActive=!1,p[i].descriptionActive=!1},s.transition_time).then(function(){n.resolve()})},s.transition_time_padding),n.promise}(a,_).then(g),v=0;v<=s.row_count_zero;v++)if(v!=a)for(y=o.rows[s.ppr_key][v].toggles,l=0;l<=s.pieces_per_row_zero;l++)y[l].notFlippable=!1,y[l].fade=!1;r(function(){o.rows[s.ppr_key][a].toggles.active_row=!1,_=a=p=!1},s.transition_time_full)}}else{p=!0,a=n,_=f,o.rows[s.ppr_key][a].toggles.active_row=!0,c=i.pageYOffset,function(e,i){h();var n=t.defer(),p=o.rows[s.ppr_key][e].toggles;return p[i].showMoreActive=!0,p[i].descriptionActive=!0,w(e,i),r(function(){},s.transition_time).then(function(){n.resolve()}),n.promise}(a,_).then(g);for(var l=0;l<=s.pieces_per_row_zero;l++)l!=_&&d(a,_,l).then(g);for(var v=0;v<=s.row_count_zero;v++)if(v!=a){var y=o.rows[s.ppr_key][v].toggles;for(l=0;l<=s.pieces_per_row_zero;l++)y[l].notFlippable=!0,y[l].fade=!0}}},e(function(){!p||f||o.curr_transforming||250<Math.abs(i.pageYOffset-c)&&(f=!0,o.showMoreToggle(null,a,_,!0),r(function(){f=!1},s.transition_time_full))},1e3)}]).controller("mobileController",["$scope","$window",function(o,t){}]),o.module("portfolio").provider("appConfig",function(){var o;function t(o,t,r,e,i){this.theme=o,this.pieces_per_row=t,this.image_ratio=r,this.target=e,this.app_path=i,this.transition_time=400,this.transition_time_between=50,this.pieces_per_row_zero=this.pieces_per_row-1,this.ppr_key="ppr_"+this.pieces_per_row.toString(),this.transition_time_padding=this.transition_time+this.transition_time_between,this.transition_time_full=2*this.transition_time+this.transition_time_between}return{createConfig:function(r,e,i,n,s){o=new t(r,e,i,n,s)},$get:function(){return{getConfig:function(){return o}}}}}),o.module("portfolio").config(["appConfigProvider",function(o){o.createConfig("mk",3,"portrait","http://www.benteegarden.com/api/portfolio/mk/mk.jsonp?callback=JSON_CALLBACK","angular-portfolio-app/")}]),o.module("portfolio").factory("preloaderFactory",["$q","$rootScope",function(t,r){function e(o){this.imageLocations=o,this.imageCount=this.imageLocations.length,this.loadCount=0,this.errorCount=0,this.states={PENDING:1,LOADING:2,RESOLVED:3,REJECTED:4},this.state=this.states.PENDING,this.deferred=t.defer(),this.promise=this.deferred.promise}return e.preloadImages=function(o){return new e(o).load()},e.prototype={constructor:e,isInitiated:function(){return this.state!==this.states.PENDING},isRejected:function(){return this.state===this.states.REJECTED},isResolved:function(){return this.state===this.states.RESOLVED},load:function(){if(this.isInitiated())return this.promise;this.state=this.states.LOADING;for(var o=0;o<this.imageCount;o++)this.loadImageLocation(this.imageLocations[o]);return this.promise},handleImageError:function(o){this.errorCount++,this.isRejected()||(this.state=this.states.REJECTED,this.deferred.reject(o))},handleImageLoad:function(o){this.loadCount++,this.isRejected()||(this.deferred.notify({percent:Math.ceil(this.loadCount/this.imageCount*100),imageLocation:o}),this.loadCount===this.imageCount&&(this.state=this.states.RESOLVED,this.deferred.resolve(this.imageLocations)))},loadImageLocation:function(t){var e=this;o.element(new Image).load(function(o){r.$apply(function(){e.handleImageLoad(o.target.src),e=o=null})}).error(function(o){r.$apply(function(){e.handleImageError(o.target.src),e=o=null})}).prop("src",t)}},e}]),o.module("portfolio").factory("rowsFactory",["$http","$q","preloaderFactory","appConfig",function(r,e,i,n){delete r.defaults.headers.common["X-Requested-With"];var s=n.getConfig(),a=function(o,r,e){var i=o.splice(0,r);if(r.toString(),i.length!==r)return!1;for(i.toggles=[],t=0;t<r;t++)i.toggles[t]=new _,i.toggles.active_row=!1;return[o,i]},_=function(){this.transform=!1,this.transforming=!1,this.frontHover=!1,this.descriptionActive=!1,this.noFlipHelp=!1,this.notFlippable=!1,this.frontSwapped=!1,this.backSwapped=!1,this.showMoreActive=!1,this.fade=!1,this.hidePrimaryImg=!1,this.hideBackNbrImg_0=!0,this.hideBackNbrImg_1=!0,this.hideBackNbrImg_2=!0,this.hideFrontNbrImg_0=!0,this.hideFrontNbrImg_1=!0,this.hideFrontNbrImg_2=!0},c={getRows:function(){var t=e.defer();return function(){var o=e.defer();return r({method:"JSONP",url:s.target}).success(function(t){s.pieces_count=t.portfolio.length,s.pieces_count_zero=s.pieces_count-1,o.resolve(t)}).error(function(){o.reject()}),o.promise}().then(function(r){var n=function(t){for(var r=[],e=[],i=[],n=[],p=0;p<=s.pieces_count_zero;p++){for(var a=t.portfolio[p].images,_=0;_<a.length;_++)a[_]=a[_].src,r.push(a[_]);n[p]=o.copy(t.portfolio[p]),n[p].images=o.copy(a),i[p]=[];for(var c=0;c<a.length;c++)0===c?(t.portfolio[p].primary_img=a[c],e[p]=a[c]):i[p].push(a[c])}return{refactored_data:t,all_images:r,primary_images:e,secondary_images:i,mobile_rows:n}}(r),_=function(o){var t=e.defer();return i.preloadImages(o).then(function(){t.resolve()},function(){t.reject()}),t.promise}(n.primary_images),c=function(t,r){var e={ppr_1:[],ppr_2:[],ppr_3:[]},i=o.copy(t.portfolio),n=o.copy(t.portfolio);for(s.ppr_2_row_count=0,s.ppr_3_row_count=0,p=0;p<=s.pieces_count_zero;p++){var _=a(i,2,s.ppr_2_row_count);_&&(i=_[0],e.ppr_2[s.ppr_2_row_count]=_[1],s.ppr_2_row_count++),(_=a(n,3,s.ppr_3_row_count))&&(n=_[0],e.ppr_3[s.ppr_3_row_count]=_[1],s.ppr_3_row_count++)}return e.ppr_1=r,s.ppr_1_row_count=s.pieces_count,s.ppr_1_row_count_zero=s.pieces_count_zero,s.ppr_2_row_count_zero=s.ppr_2_row_count-1,s.ppr_3_row_count_zero=s.ppr_3_row_count-1,2===s.pieces_per_row?(s.row_count=s.ppr_2_row_count,s.row_count_zero=s.ppr_2_row_count_zero):(s.row_count=s.ppr_3_row_count,s.row_count_zero=s.ppr_3_row_count_zero),e}(function(o,t){for(p=0;p<=s.pieces_count_zero;p++){var r,e,i=p%3;o.portfolio[p].nbr_imgs_3_row=[],0===i?(o.portfolio[p].row_position="left",void 0!==t[r=p+1]&&(r=t[r][0]),void 0!==t[e=p+2]&&(e=t[e][0])):1===i?(o.portfolio[p].row_position="center",void 0!==t[r=p-1]&&(r=t[r][0]),void 0!==t[e=p+1]&&(e=t[e][1])):2===i&&(o.portfolio[p].row_position="right",void 0!==t[r=p-2]&&(r=t[r][1]),void 0!==t[e=p-1]&&(e=t[e][1])),r&&(o.portfolio[p].nbr_imgs_3_row[0]=r),e&&(o.portfolio[p].nbr_imgs_3_row[1]=e),i=p%2,r=null,o.portfolio[p].nbr_imgs_2_row=[],0===i?(o.portfolio[p].row_position="left",void 0!==t[r=p+1]&&(r=t[r][0])):1===i&&(o.portfolio[p].row_position="right",void 0!==t[r=p-1]&&(r=t[r][0])),r&&(o.portfolio[p].nbr_imgs_2_row[0]=r)}return o}(n.refactored_data,n.secondary_images),n.mobile_rows);e.all([_]).then(function(){t.resolve(c)})}),t.promise}};return c}])}(angular);