!function(angular){angular.module("portfolio",["angular-flexslider"]).controller("PortfolioController",["$scope","$timeout","$window","rowsFactory","appConfig",function($scope,$timeout,$window,rowsFactory,appConfig){$scope.overflow_hidden=!1;var config=appConfig.getConfig();$scope.theme=config.theme,$scope.image_ratio=config.image_ratio,$scope.pieces_per_row=config.pieces_per_row,$scope.app_path=config.app_path,$scope.rows||rowsFactory.getRows().then(function(rows){$scope.rows=rows}),$scope.$watch(function(){return $window.innerWidth},function(value){$scope.window_width=value})}]).controller("desktopController",["$scope","$q","$timeout","$interval","$window","appConfig",function($scope,$q,$timeout,$interval,$window,appConfig){var config=appConfig.getConfig(),show_more_active=!1,active_row=!1,active_piece=!1,active_scroll_pos=0,scroll_timeout=!1,flip_start_counter=0,flip_complete_counter=0;function flipStartTracker(){0===flip_start_counter&&($scope.$parent.overflow_hidden=!0,$scope.curr_transforming=!0),flip_start_counter<config.pieces_per_row&&flip_start_counter++}function flipCompleteTracker(){++flip_complete_counter==config.pieces_per_row&&$timeout(function(){flip_complete_counter=flip_start_counter=0,$scope.curr_transforming=!1,$scope.$parent.overflow_hidden=!1},50)}function flipFrontToNeighbor(active_row,active_piece,piece){flipStartTracker();var deferred=$q.defer(),toggles=$scope.rows[config.ppr_key][active_row].toggles;return $timeout(function(){toggles[piece]["hideBackNbrImg_"+active_piece.toString()]=!1,toggles[piece].descriptionActive=!1,toggles[piece].notFlippable=!0,transformingClassToggle(active_row,piece),$timeout(function(){},config.transition_time).then(function(){deferred.resolve()})},config.transition_time_padding),deferred.promise}function flipNeighborToFront(active_row,active_piece,piece){flipStartTracker();var deferred=$q.defer(),toggles=$scope.rows[config.ppr_key][active_row].toggles;return toggles[piece].descriptionActive=!1,toggles[piece].notFlippable=!1,transformingClassToggle(active_row,piece),$timeout(function(){toggles[piece]["hideBackNbrImg_"+active_piece.toString()]=!0,deferred.resolve()},config.transition_time),deferred.promise}function transformingClassToggle(active_row,piece){var toggles=$scope.rows[config.ppr_key][active_row].toggles;toggles[piece].transforming=!0,toggles[piece].transform=!toggles[piece].transform,toggles[piece].frontHover=!1,$timeout(function(){toggles[piece].transforming=!1},config.transition_time)}$scope.curr_transforming=!1,$scope.showMoreToggle=function(event,origin_row,origin_piece,origin_close_button){if(event&&event.stopPropagation(),!$scope.curr_transforming)if(show_more_active){if(origin_close_button||origin_row!=active_row||origin_row==active_row&&origin_piece!=active_piece){for(p=0;p<=config.pieces_per_row_zero;p++)p!=active_piece&&flipNeighborToFront(active_row,active_piece,p).then(flipCompleteTracker);for(function(active_row,active_piece){flipStartTracker();var deferred=$q.defer(),toggles=$scope.rows[config.ppr_key][active_row].toggles;return $timeout(function(){transformingClassToggle(active_row,active_piece),$timeout(function(){toggles[active_piece].showMoreActive=!1,toggles[active_piece].descriptionActive=!1},config.transition_time).then(function(){deferred.resolve()})},config.transition_time_padding),deferred.promise}(active_row,active_piece).then(flipCompleteTracker),r=0;r<=config.row_count_zero;r++)if(r!=active_row)for(toggles=$scope.rows[config.ppr_key][r].toggles,p=0;p<=config.pieces_per_row_zero;p++)toggles[p].notFlippable=!1,toggles[p].fade=!1;$timeout(function(){$scope.rows[config.ppr_key][active_row].toggles.active_row=!1,active_piece=active_row=show_more_active=!1},config.transition_time_full)}}else{show_more_active=!0,active_row=origin_row,active_piece=origin_piece,$scope.rows[config.ppr_key][active_row].toggles.active_row=!0,active_scroll_pos=$window.pageYOffset,function(active_row,active_piece){flipStartTracker();var deferred=$q.defer(),toggles=$scope.rows[config.ppr_key][active_row].toggles;return toggles[active_piece].showMoreActive=!0,toggles[active_piece].descriptionActive=!0,transformingClassToggle(active_row,active_piece),$timeout(function(){},config.transition_time).then(function(){deferred.resolve()}),deferred.promise}(active_row,active_piece).then(flipCompleteTracker);for(var p=0;p<=config.pieces_per_row_zero;p++)p!=active_piece&&flipFrontToNeighbor(active_row,active_piece,p).then(flipCompleteTracker);for(var r=0;r<=config.row_count_zero;r++)if(r!=active_row)for(var toggles=$scope.rows[config.ppr_key][r].toggles,p=0;p<=config.pieces_per_row_zero;p++)toggles[p].notFlippable=!0,toggles[p].fade=!0}},$interval(function(){!show_more_active||scroll_timeout||$scope.curr_transforming||250<Math.abs($window.pageYOffset-active_scroll_pos)&&(scroll_timeout=!0,$scope.showMoreToggle(null,active_row,active_piece,!0),$timeout(function(){scroll_timeout=!1},config.transition_time_full))},1e3)}]).controller("mobileController",["$scope","$window",function($scope,$window){}]),angular.module("portfolio").provider("appConfig",function(){var config_obj;function config(theme,pieces_per_row,image_ratio,target,app_path){this.theme=theme,this.pieces_per_row=pieces_per_row,this.image_ratio=image_ratio,this.target=target,this.app_path=app_path,this.transition_time=400,this.transition_time_between=50,this.pieces_per_row_zero=this.pieces_per_row-1,this.ppr_key="ppr_"+this.pieces_per_row.toString(),this.transition_time_padding=this.transition_time+this.transition_time_between,this.transition_time_full=2*this.transition_time+this.transition_time_between}return{createConfig:function(theme,pieces_per_row,image_ratio,target,app_path){config_obj=new config(theme,pieces_per_row,image_ratio,target,app_path)},$get:function(){return{getConfig:function(){return config_obj}}}}}),angular.module("portfolio").config(["appConfigProvider",function(appConfigProvider){appConfigProvider.createConfig("blt",2,"landscape","https://www.benteegarden.com/api/portfolio/blt/mk.jsonp?callback=JSON_CALLBACK","sites/all/themes/blt/angular-portfolio-app/")}]),angular.module("portfolio").factory("preloaderFactory",["$q","$rootScope",function($q,$rootScope){function Preloader(imageLocations){this.imageLocations=imageLocations,this.imageCount=this.imageLocations.length,this.loadCount=0,this.errorCount=0,this.states={PENDING:1,LOADING:2,RESOLVED:3,REJECTED:4},this.state=this.states.PENDING,this.deferred=$q.defer(),this.promise=this.deferred.promise}return Preloader.preloadImages=function(imageLocations){return new Preloader(imageLocations).load()},Preloader.prototype={constructor:Preloader,isInitiated:function(){return this.state!==this.states.PENDING},isRejected:function(){return this.state===this.states.REJECTED},isResolved:function(){return this.state===this.states.RESOLVED},load:function(){if(this.isInitiated())return this.promise;this.state=this.states.LOADING;for(var i=0;i<this.imageCount;i++)this.loadImageLocation(this.imageLocations[i]);return this.promise},handleImageError:function(imageLocation){this.errorCount++,this.isRejected()||(this.state=this.states.REJECTED,this.deferred.reject(imageLocation))},handleImageLoad:function(imageLocation){this.loadCount++,this.isRejected()||(this.deferred.notify({percent:Math.ceil(this.loadCount/this.imageCount*100),imageLocation:imageLocation}),this.loadCount===this.imageCount&&(this.state=this.states.RESOLVED,this.deferred.resolve(this.imageLocations)))},loadImageLocation:function(imageLocation){var preloader=this;angular.element(new Image).load(function(event){$rootScope.$apply(function(){preloader.handleImageLoad(event.target.src),preloader=event=null})}).error(function(event){$rootScope.$apply(function(){preloader.handleImageError(event.target.src),preloader=event=null})}).prop("src",imageLocation)}},Preloader}]),angular.module("portfolio").factory("rowsFactory",["$http","$q","preloaderFactory","appConfig",function($http,$q,preloaderFactory,appConfig){delete $http.defaults.headers.common["X-Requested-With"];var config=appConfig.getConfig(),rowSplitter=function(pieces,pieces_per_row,row_count){var new_row=pieces.splice(0,pieces_per_row);if(pieces_per_row.toString(),new_row.length!==pieces_per_row)return!1;for(new_row.toggles=[],t=0;t<pieces_per_row;t++)new_row.toggles[t]=new toggles,new_row.toggles.active_row=!1;return[pieces,new_row]},toggles=function(){this.transform=!1,this.transforming=!1,this.frontHover=!1,this.descriptionActive=!1,this.noFlipHelp=!1,this.notFlippable=!1,this.frontSwapped=!1,this.backSwapped=!1,this.showMoreActive=!1,this.fade=!1,this.hidePrimaryImg=!1,this.hideBackNbrImg_0=!0,this.hideBackNbrImg_1=!0,this.hideBackNbrImg_2=!0,this.hideFrontNbrImg_0=!0,this.hideFrontNbrImg_1=!0,this.hideFrontNbrImg_2=!0},factory={};return factory.getRows=function(){var deferred=$q.defer();return function(){var deferred=$q.defer();return $http({method:"JSONP",url:config.target}).success(function(data){config.pieces_count=data.portfolio.length,config.pieces_count_zero=config.pieces_count-1,deferred.resolve(data)}).error(function(){deferred.reject()}),deferred.promise}().then(function(data){var images_data=function(data){for(var all_images=[],primary_images=[],secondary_images=[],mobile_rows=[],p=0;p<=config.pieces_count_zero;p++){for(var images=data.portfolio[p].images,b=0;b<images.length;b++)images[b]=images[b].src,all_images.push(images[b]);mobile_rows[p]=angular.copy(data.portfolio[p]),mobile_rows[p].images=angular.copy(images),secondary_images[p]=[];for(var i=0;i<images.length;i++)0===i?(data.portfolio[p].primary_img=images[i],primary_images[p]=images[i]):secondary_images[p].push(images[i])}return{refactored_data:data,all_images:all_images,primary_images:primary_images,secondary_images:secondary_images,mobile_rows:mobile_rows}}(data),preload_images_promise=function(all_images){var deferred=$q.defer();return preloaderFactory.preloadImages(all_images).then(function(){deferred.resolve()},function(){deferred.reject()}),deferred.promise}(images_data.primary_images),rows=function(data,mobile_rows){var rows={ppr_1:[],ppr_2:[],ppr_3:[]},split_pieces_2_row=angular.copy(data.portfolio),split_pieces_3_row=angular.copy(data.portfolio);for(config.ppr_2_row_count=0,config.ppr_3_row_count=0,p=0;p<=config.pieces_count_zero;p++){var new_row=rowSplitter(split_pieces_2_row,2,config.ppr_2_row_count);new_row&&(split_pieces_2_row=new_row[0],rows.ppr_2[config.ppr_2_row_count]=new_row[1],config.ppr_2_row_count++),(new_row=rowSplitter(split_pieces_3_row,3,config.ppr_3_row_count))&&(split_pieces_3_row=new_row[0],rows.ppr_3[config.ppr_3_row_count]=new_row[1],config.ppr_3_row_count++)}return rows.ppr_1=mobile_rows,config.ppr_1_row_count=config.pieces_count,config.ppr_1_row_count_zero=config.pieces_count_zero,config.ppr_2_row_count_zero=config.ppr_2_row_count-1,config.ppr_3_row_count_zero=config.ppr_3_row_count-1,2===config.pieces_per_row?(config.row_count=config.ppr_2_row_count,config.row_count_zero=config.ppr_2_row_count_zero):(config.row_count=config.ppr_3_row_count,config.row_count_zero=config.ppr_3_row_count_zero),rows}(function(data,secondary_images){for(p=0;p<=config.pieces_count_zero;p++){var neighbor1,neighbor2,mod=p%3;data.portfolio[p].nbr_imgs_3_row=[],0===mod?(data.portfolio[p].row_position="left",void 0!==secondary_images[neighbor1=p+1]&&(neighbor1=secondary_images[neighbor1][0]),void 0!==secondary_images[neighbor2=p+2]&&(neighbor2=secondary_images[neighbor2][0])):1===mod?(data.portfolio[p].row_position="center",void 0!==secondary_images[neighbor1=p-1]&&(neighbor1=secondary_images[neighbor1][0]),void 0!==secondary_images[neighbor2=p+1]&&(neighbor2=secondary_images[neighbor2][1])):2===mod&&(data.portfolio[p].row_position="right",void 0!==secondary_images[neighbor1=p-2]&&(neighbor1=secondary_images[neighbor1][1]),void 0!==secondary_images[neighbor2=p-1]&&(neighbor2=secondary_images[neighbor2][1])),neighbor1&&(data.portfolio[p].nbr_imgs_3_row[0]=neighbor1),neighbor2&&(data.portfolio[p].nbr_imgs_3_row[1]=neighbor2),mod=p%2,neighbor1=null,data.portfolio[p].nbr_imgs_2_row=[],0===mod?(data.portfolio[p].row_position="left",void 0!==secondary_images[neighbor1=p+1]&&(neighbor1=secondary_images[neighbor1][0])):1===mod&&(data.portfolio[p].row_position="right",void 0!==secondary_images[neighbor1=p-1]&&(neighbor1=secondary_images[neighbor1][0])),neighbor1&&(data.portfolio[p].nbr_imgs_2_row[0]=neighbor1)}return data}(images_data.refactored_data,images_data.secondary_images),images_data.mobile_rows);$q.all([preload_images_promise]).then(function(){deferred.resolve(rows)})}),deferred.promise},factory}])}(angular);